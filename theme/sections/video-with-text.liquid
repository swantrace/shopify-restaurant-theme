<div class="
          section-inner-wrapper
          {% if section.settings.disable_on_mobile %}disable_on_mobile{% endif %}
          {% if section.settings.disable_on_tablet %}disable_on_tablet{% endif %}
          {% if section.settings.disable_on_desktop %}disable_on_desktop{% endif %}
          bg-{{ settings.default_style_mode }}
          ">
        <div class="{% if section.settings.section_width == 'container' %}container {% else %}container-fluid{% endif %}"> 
            <div class="row no-gutters">
              <div class="col col-12 col-lg-6 mb-20 mb-lg-0 align-self-center order-first
              {% if section.settings.video_position == 'left' %}order-lg-first{% endif %} {% if section.settings.video_position == 'right' %}order-lg-last{% endif %}
              ">
                <div class="video-iframe-wrapper embed-responsive embed-responsive-16by9">
                  <div id="video-iframe"></div>
                  <div class="video-image">
                    <button class="btn video-control video-control__play video-play-btn">
                      {% render 'icon-play' %}
                    </button>
                  </div>
                </div>
              </div>
            <div class="col col-12 col-lg-6 align-self-center px-10 px-md-20 px-lg-30 ml-auto text-{{ section.settings.alignment }} text-{{ settings.default_style_mode }}-text">
              <h3 class="video-with-text-header">{{ section.settings.header }}</h3>
              <div class="content">
                {{ section.settings.text }}
              </div>
              <a class="btn bg-{{ settings.default_style_mode }}-filled-btn text-{{ settings.default_style_mode }}-filled-btn-text mr-sm-10 mb-10" href="{{ section.settings.first_button_link }}">{{ section.settings.first_button_label }}</a>
              <a class="btn border-{{ settings.default_style_mode }}-outline-btn-border bg-{{ settings.default_style_mode }}-outline-btn text-{{ settings.default_style_mode }}-outline-btn-text mb-10" href="{{ section.settings.second_button_link }}" >{{ section.settings.second_button_label }}</a>
            </div>
            </div>
        </div>
</div>

{% render 'common-section-styles' %}
<style>

  #shopify-section-{{ section.id }} .video-iframe-wrapper .video-image{
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image: url("{{ section.settings.video_image | img_url: '720x486', crop: 'center'  }}");
    background-repeat: no-repeat;
    background-size: cover;
    background-position: center center;
    display: flex;
    justify-content: center;
    align-items: center;
    opacity: 1;
    transition: opacity 0.4s;
  }

  #shopify-section-{{ section.id }} .video-play-btn {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 0 auto;
    padding: 5px;
    background: white;
    border: 1px solid black;
  }

  #shopify-section-{{ section.id }} .video-iframe-wrapper.video-is-playing .video-image {
    opacity: 0;
    transition: opacity 0.4s;
    z-index: -99999;
  }

</style>
<script>
  const tag = document.createElement('script');
  tag.id = 'iframe-demo';
  tag.src = 'https://www.youtube.com/iframe_api';
  const firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

  let player;
  function onYouTubeIframeAPIReady() {
    player = new YT.Player('video-iframe', {
        class: 'embed-responsive-item',
        videoId: 'zpOULjyy-n8',
        events: {
          'onReady': onPlayerReady,
          'onStateChange': onPlayerStateChange
        }
    });
  }

  function onPlayerReady(event) {
    const videoIframeWrapper = document.querySelector(".video-iframe-wrapper");
    const videoPlayButton = document.querySelector(".video-iframe-wrapper .video-play-btn");
    if(videoPlayButton && videoIframeWrapper) {
      videoPlayButton.addEventListener("click", function(){
        videoIframeWrapper.classList.add("video-is-playing");
        event.target.playVideo();
      });
    }
  }

  function onPlayerStateChange(event) {
    const playerStatus = event.data;
    if(playerStatus == 0 || playerStatus == 2) {
      const videoIframeWrapper = document.querySelector(".video-iframe-wrapper");
      const videoPlayButton = document.querySelector(".video-iframe-wrapper .video-play-btn");
      if(videoPlayButton && videoIframeWrapper) {
        videoIframeWrapper.classList.remove("video-is-playing");
      }
    }
  }
</script>
{% schema %}
{
  "name": {
    "en": "Video with text"
  },
  "class": "index-section index-section--video-with-text",
  "tag": "section",
  "settings": [
  {
      "type": "header",
      "content": {
        "en": "Background"
      }
    },
    {
      "type": "image_picker",
      "id": "img_bg",
      "label": {
        "en": "Background image"
      }
    },
    {
      "type": "color",
      "id": "color_bg",
      "label": {
        "en": "Background color"
      } 
   },
    {
      "type": "header",
      "content": {
        "en": "Layout"
      }
    },
    {
      "type": "select",
      "id": "section_width",
      "label": {
        "en": "Section Width"
      },
      "default": "full",
      "options": [
        {
          "label": {
            "en": "Container Width"
          },
          "value": "container"
        },
        {
          "label": {
            "en": "Full width"
          },
          "value": "full"
        }
      ]
    },
    {
      "type": "checkbox",
      "id": "disable_on_mobile",
      "label":{
        "en": "Disable on mobile"
      },
      "default": false
    },
    {
      "type": "checkbox",
      "id": "disable_on_tablet",
      "label":{
        "en": "Disable on tablet"
      },
      "default": false
    },
    {
      "type": "checkbox",
      "id": "disable_on_desktop",
      "label":{
        "en": "Disable on desktop"
      },
      "default": false
    },
    {
      "type": "header",
      "content": {
        "en": "Section Content"
      }
    },
    {
      "type": "video_url",
      "id": "video_link",
      "label": {
        "en": "Video link"
      },
      "accept": [
        "youtube",
        "vimeo"
      ],
      "default": "https://www.youtube.com/watch?v=_9VUPq3SxOc"
    },
    {
      "type": "image_picker",
      "id": "video_image",
      "label": {
        "en": "Video image"
      }
    },
    {
      "type": "select",
      "id": "video_position",
      "label": {
        "en": "Video position"
      },
      "default": "left",
      "options": [
        {
          "label": {
            "en": "Left"
          },
          "value": "left"
        },
        {
          "label": {
            "en": "Right"
          },
          "value": "right"
        }
      ]
    },
    {
      "type": "text",
      "id": "first_button_label",
      "label": {
        "en": "First Button label"
      }
    },
    {
      "type": "url",
      "id": "first_button_link",
      "label": {
        "en": "First button link"
      }
    },
    {
      "type": "text",
      "id": "second_button_label",
      "label": {
        "en": "Second button label"
      }
    },
    {
      "type": "url",
      "id": "second_button_link",
      "label": {
        "en": "Second button link"
      }
    },
    {
      "type": "text",
      "id": "header",
      "label": {
        "en": "Header"
      }
    },
    {
      "type": "richtext",
      "id": "text",
      "label": {
        "en": "Text"
      }
    },
    {
      "type": "select",
      "id": "alignment",
      "label": {
        "en": "Content alignment"
      },
      "default": "center",
      "options":[
        {
          "label": {
            "en": "Left"
          },
          "value": "left"
        },
        {
          "label": {
            "en": "Center"
          },
          "value": "center"
        },
        {
          "label": {
            "en": "Right"
          },
          "value": "right"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": {
        "en": "Video with text"
      },
      "category": {
        "en": "Video"
      }
    }
  ]
}
{% endschema %}